wait(15)
-- Получаем сервисы
local Players           = game:GetService("Players")
local HttpService       = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService      = game:GetService("TweenService")
local RunService        = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- Переменные игрока и GUI
local player    = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local placeId   = game.PlaceId

-- === Создаём свой ScreenGui и основу UI ===
local gui = Instance.new("ScreenGui")
gui.Name           = "SkrilyaHubOverlay"
gui.ResetOnSpawn   = false
gui.IgnoreGuiInset = true
gui.Parent         = playerGui

local blackFrame = Instance.new("Frame")
blackFrame.Size            = UDim2.new(1, 0, 1, 0)
blackFrame.Position        = UDim2.new(0, 0, 0, 0)
blackFrame.BackgroundColor3= Color3.new(0, 0, 0)
blackFrame.BorderSizePixel = 0
blackFrame.Parent          = gui

-- Вертикальный список по центру
local listLayout = Instance.new("UIListLayout")
listLayout.SortOrder           = Enum.SortOrder.LayoutOrder
listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
listLayout.VerticalAlignment   = Enum.VerticalAlignment.Center
listLayout.Padding             = UDim.new(0, 10)
listLayout.Parent              = blackFrame

-- Заголовок
local title = Instance.new("TextLabel")
title.Size                   = UDim2.new(1, 0, 0, 60)
title.BackgroundTransparency = 1
title.Text                   = "SkrilyaHub"
title.TextColor3             = Color3.new(1, 1, 1)
title.Font                   = Enum.Font.GothamBlack
title.TextScaled             = true
title.LayoutOrder            = 1
title.Parent                 = blackFrame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Name                   = "ToggleBlackScreenButton"
toggleBtn.Size                   = UDim2.new(0, 180, 0, 40)
toggleBtn.Position               = UDim2.new(0.5, -90, 1, -50)
toggleBtn.AnchorPoint            = Vector2.new(0.5, 0)
toggleBtn.BackgroundColor3       = Color3.fromRGB(50, 50, 50)
toggleBtn.BorderSizePixel        = 0
toggleBtn.BackgroundTransparency = 0.2
toggleBtn.Text                   = "On/Off Black Screen"
toggleBtn.Font                   = Enum.Font.GothamBold
toggleBtn.TextSize               = 18
toggleBtn.TextColor3            = Color3.new(1, 1, 1)
toggleBtn.Parent                 = gui

-- Функция переключения видимости blackFrame
local isBlackVisible = true

toggleBtn.MouseButton1Click:Connect(function()
    isBlackVisible = not isBlackVisible
    blackFrame.Visible = isBlackVisible
end)

-- Стилизация при наведении
toggleBtn.MouseEnter:Connect(function()
    toggleBtn.BackgroundTransparency = 0
end)
toggleBtn.MouseLeave:Connect(function()
    toggleBtn.BackgroundTransparency = 0.2
end)

-- Утилита для добавления серых текстовых строк
local orderCounter = 2
local function addGrayText(text)
    local lbl = Instance.new("TextLabel")
    lbl.Size                   = UDim2.new(1, -40, 0, 25)
    lbl.BackgroundTransparency = 1
    lbl.Text                   = text
    lbl.TextColor3             = Color3.fromRGB(180, 180, 180)
    lbl.Font                   = Enum.Font.Gotham
    lbl.TextScaled             = false
    lbl.TextSize               = 20
    lbl.TextXAlignment         = Enum.TextXAlignment.Center
    lbl.LayoutOrder            = orderCounter
    lbl.Parent                 = blackFrame
    orderCounter = orderCounter + 1
end

-- Безопасное чтение текста из GUI
local function safeGet(path)
    local ok, val = pcall(function() return path.Text end)
    return ok and val or "N/A"
end

-- Получаем Gems и Gold из существующего GUI (если есть)
local gemsText, goldText = "N/A", "N/A"
do
    local existingGui = playerGui:FindFirstChild("ScreenGui")
    if existingGui then
        local frame = existingGui:FindFirstChild("Frame")
        if frame then
            local gemsContainer = frame:FindFirstChild("Gems")
            if gemsContainer then
                gemsText = safeGet(gemsContainer:FindFirstChild("Gems") and gemsContainer.Gems:FindFirstChild("TextLabel") or {Text="N/A"})
                goldText = safeGet(gemsContainer:FindFirstChild("Gold") and gemsContainer.Gold:FindFirstChild("TextLabel") or {Text="N/A"})
            end
        end
    end
end

-- Получаем Trait из Window → Trait
local traitText = "N/A"
do
    local windowGui = playerGui:FindFirstChild("Window")
    if windowGui then
        local traitFrame = windowGui:FindFirstChild("Trait")
        if traitFrame then
            traitText = safeGet(
                traitFrame.Frame:FindFirstChild("main") and
                traitFrame.Frame.main:FindFirstChild("item") and
                traitFrame.Frame.main.item:FindFirstChild("number") or {Text="N/A"}
            )
        end
    end
end

-- === Работа с конфигом ===
local configName = "SkrilyaHub_Config.json"
if placeId == 17850641257 then
    -- Сохраняем
    local cfg = { Gems = gemsText, Gold = goldText, Trait = traitText }
    writefile(configName, HttpService:JSONEncode(cfg))

    addGrayText("Gems: "  .. gemsText)
    addGrayText("Gold: "  .. goldText)
    addGrayText("Trait: " .. traitText)
    addGrayText("Конфиг сохранён")

    -- Задержка 2 секунды, затем JoinRoom Create и TeleGameplay
    task.delay(2, function()
        -- Script generated by SimpleSpy - credits to exx#9394
        local argsCreate = {
            [1] = "Create",
            [2] = "Story",
            [3] = 1,
            [4] = 1,
            [5] = 1,
            [6] = true
        }
        game:GetService("ReplicatedStorage").Event.JoinRoom:FireServer(unpack(argsCreate))

        -- Ещё одна задержка 0.5 секунды между вызовами (по желанию)
        task.wait(0.5)

        local argsTeleport = {
            [1] = "TeleGameplay",
            [2] = "Story",
            [3] = 1,
            [4] = 1,
            [5] = 1,
            [6] = true
        }
        game:GetService("ReplicatedStorage").Event.JoinRoom:FireServer(unpack(argsTeleport))
    end)
else
    -- Загружаем
    if isfile(configName) then
        local data = HttpService:JSONDecode(readfile(configName))

        addGrayText("Загружено из кфг::")
        addGrayText("Gems: "  .. data.Gems)
        addGrayText("Gold: "  .. data.Gold)
        addGrayText("Trait: " .. data.Trait)
    else
        addGrayText("Конфиг не найден")
    end
end

-- Автовызов Ready-кнопки
game:GetService("Players")
    .LocalPlayer.PlayerGui
    .RoomUi.Ready.Frame
    .StartButton.Butom.LocalScript
    .RemoteEvent:FireServer()

-- === Автофарм мобов и платформа ===
local character = player.Character or player.CharacterAdded:Wait()
local hrp       = character:WaitForChild("HumanoidRootPart")

local offsetY     = 0
local hoverRadius = 5
local hoverSpeed  = 2

local platform = Instance.new("Part")
platform.Size        = Vector3.new(15, 1, 15)
platform.Anchored    = true
platform.CanCollide  = false
platform.Transparency= 0.5
platform.Parent      = workspace

RunService.Heartbeat:Connect(function()
    platform.CFrame = hrp.CFrame * CFrame.new(0, -2, 0)
end)

local function getClosestMob()
    for _, mob in pairs(workspace.Enemy.Mob:GetChildren()) do
        if mob:IsA("Model")
        and mob:FindFirstChild("Humanoid")
        and mob.Humanoid.Health > 0
        and mob:FindFirstChild("HumanoidRootPart") then
            return mob
        end
    end
    return nil
end

local function flyToTarget(pos, duration)
    return TweenService:Create(hrp, TweenInfo.new(duration, Enum.EasingStyle.Sine), {
        CFrame = CFrame.new(pos.X, hrp.Position.Y, pos.Z)
    })
end

local function hoverAbove(targetPart, stopSignal)
    local angle = 0
    return RunService.Heartbeat:Connect(function(dt)
        if stopSignal.stop then return end
        angle += dt * hoverSpeed
        local x = math.cos(angle) * hoverRadius
        local z = math.sin(angle) * hoverRadius
        local newPos = targetPart.Position + Vector3.new(x, offsetY, z)
        hrp.CFrame = CFrame.new(newPos, targetPart.Position)
    end)
end

local function pressKey(keyCode, duration)
    VirtualInputManager:SendKeyEvent(true,  keyCode, false, nil)
    task.wait(duration or 0.1)
    VirtualInputManager:SendKeyEvent(false, keyCode, false, nil)
end

local function pressKeysInOrder()
    local sequence = {
        {Enum.KeyCode.ButtonX, 4},
        {Enum.KeyCode.Z,       1},
        {Enum.KeyCode.ButtonX, 4},
        {Enum.KeyCode.ButtonX, 1},
        {Enum.KeyCode.ButtonX, 4},
        {Enum.KeyCode.C,       1},
    }
    while true do
        for _, keyData in ipairs(sequence) do
            for i = 1, keyData[2] do
                pressKey(keyData[1])
                task.wait(0.1)
            end
        end
        task.wait(0.5)
    end
end

task.spawn(function()
    local noMobsTime     = 0
    local restartInterval= 3

    while true do
        local mob = getClosestMob()
        if mob then
            noMobsTime = 0
            local mobHRP  = mob:FindFirstChild("HumanoidRootPart")
            local humanoid= mob:FindFirstChild("Humanoid")
            if mobHRP and humanoid then
                local tween = flyToTarget(mobHRP.Position, 1.5)
                tween:Play()
                tween.Completed:Wait()
                local stopSignal = { stop = false }
                local hoverConn  = hoverAbove(mobHRP, stopSignal)
                task.spawn(pressKeysInOrder)
                while humanoid.Health > 0 and mob.Parent do
                    task.wait(0.2)
                end
                stopSignal.stop = true
                hoverConn:Disconnect()
            end
        else
            noMobsTime += 0.5
            if noMobsTime >= restartInterval then
                warn("No mobs found for 3 seconds. Restarting...")
                ReplicatedStorage.Events.WinEvent.Buttom:FireServer("RPlay")
                noMobsTime = 0
            end
        end
        task.wait(0.5)
    end
end)

-- === Упрощение сцены ===
local function removeTextures(root)
    for _, c in pairs(root:GetDescendants()) do
        if c:IsA("Texture") or c:IsA("Decal") then
            c:Destroy()
        end
    end
end

local function simplifyToGrayCubes(root)
    for _, obj in pairs(root:GetDescendants()) do
        if obj:IsA("Texture") or obj:IsA("Decal") or obj:IsA("SurfaceAppearance") then
            obj:Destroy()
        elseif obj:IsA("SpecialMesh") or obj:IsA("FileMesh") or obj:IsA("MeshPart") then
            if obj:IsA("MeshPart") then
                local cube = Instance.new("Part")
                cube.Size       = obj.Size
                cube.CFrame     = obj.CFrame
                cube.Anchored   = obj.Anchored
                cube.CanCollide = obj.CanCollide
                cube.Parent     = obj.Parent
                obj:Destroy()
            else
                obj:Destroy()
            end
        elseif obj:IsA("BasePart") then
            obj.Material    = Enum.Material.Plastic
            obj.Color       = Color3.fromRGB(128, 128, 128)
            obj.Reflectance = 0
            obj.Transparency= 0
            obj.Shape       = Enum.PartType.Block
        end
    end
end

simplifyToGrayCubes(workspace)
removeTextures(workspace)
